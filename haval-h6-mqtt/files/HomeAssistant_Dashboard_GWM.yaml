title: Haval H6 Dashboard
config_template_card_vars:
  VEICULO: states['select.gwmbrasil_veiculos_registrados'].state.toLowerCase()
views:
  - type: panel
    path: gwm-dashboard
    title: GWM Dashboard
    icon: mdi:car-electric
    cards:
      - type: custom:config-template-card
        entities:
          - select.gwmbrasil_veiculos_registrados
          - binary_sensor.gwmbrasil_${VEICULO}_agendamento_de_carga
          - binary_sensor.gwmbrasil_${VEICULO}_estado_da_trava
          - binary_sensor.gwmbrasil_${VEICULO}_estado_do_ar_condicionado
          - binary_sensor.gwmbrasil_${VEICULO}_estado_do_controle_de_carga
          - binary_sensor.gwmbrasil_${VEICULO}_estado_do_purificador_de_ar
          - binary_sensor.gwmbrasil_${VEICULO}_porta_dianteira_direita
          - binary_sensor.gwmbrasil_${VEICULO}_porta_dianteira_esquerda
          - binary_sensor.gwmbrasil_${VEICULO}_porta_malas
          - binary_sensor.gwmbrasil_${VEICULO}_porta_traseira_direita
          - binary_sensor.gwmbrasil_${VEICULO}_porta_traseira_esquerda
          - device_tracker.gwmbrasil_${VEICULO}
          - sensor.gwmbrasil_${VEICULO}_autonomia_combustao
          - sensor.gwmbrasil_${VEICULO}_autonomia_ev
          - sensor.gwmbrasil_${VEICULO}_capacidade_do_tanque
          - sensor.gwmbrasil_${VEICULO}_cor_do_veiculo
          - sensor.gwmbrasil_${VEICULO}_estado_da_carga
          - sensor.gwmbrasil_${VEICULO}_estado_de_carga_12v
          - sensor.gwmbrasil_${VEICULO}_estado_de_carga_soc
          - sensor.gwmbrasil_${VEICULO}_estado_do_motor
          - sensor.gwmbrasil_${VEICULO}_imagem_do_veiculo
          - sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo
          - sensor.gwmbrasil_${VEICULO}_nivel_de_combustivel
          - sensor.gwmbrasil_${VEICULO}_posicao_do_teto_solar
          - sensor.gwmbrasil_${VEICULO}_pressao_do_pneu_dianteiro_direito
          - sensor.gwmbrasil_${VEICULO}_pressao_do_pneu_dianteiro_esquerdo
          - sensor.gwmbrasil_${VEICULO}_pressao_do_pneu_traseiro_direito
          - sensor.gwmbrasil_${VEICULO}_pressao_do_pneu_traseiro_esquerdo
          - sensor.gwmbrasil_${VEICULO}_quilometragem_total
          - sensor.gwmbrasil_${VEICULO}_temperatura_do_pneu_dianteiro_direito
          - sensor.gwmbrasil_${VEICULO}_temperatura_do_pneu_dianteiro_esquerdo
          - sensor.gwmbrasil_${VEICULO}_temperatura_do_pneu_traseiro_direito
          - sensor.gwmbrasil_${VEICULO}_temperatura_do_pneu_traseiro_esquerdo
          - sensor.gwmbrasil_${VEICULO}_tempo_de_carga
          - sensor.gwmbrasil_${VEICULO}_vidro_dianteiro_direito
          - sensor.gwmbrasil_${VEICULO}_vidro_dianteiro_esquerdo
          - sensor.gwmbrasil_${VEICULO}_vidro_traseiro_direito
          - sensor.gwmbrasil_${VEICULO}_vidro_traseiro_esquerdo
          - button.gwmbrasil_${VEICULO}_ativacao_do_ar_condicionado
          - button.gwmbrasil_${VEICULO}_interromper_carregamento
          - button.gwmbrasil_${VEICULO}_historico_de_carregamento
          - sensor.gwmbrasil_${VEICULO}_status_message
          - sensor.gwmbrasil_${VEICULO}_endereco_atual
        card:
          type: vertical-stack
          cards:
            - type: custom:mushroom-select-card
              entity: select.gwmbrasil_veiculos_registrados
              icon_color: disabled
              layout: horizontal
              tap_action:
                action: none
              card_mod:
                style: |
                  :host {
                    display: {% if state_attr('select.gwmbrasil_veiculos_registrados', 'options') | length > 1 %} block {% else %} none {% endif %};
                  }
                  ha-card {
                    background: none !important /*bg*/;
                    border-radius: 6px;
                  }
            - type: custom:stack-in-card
              mode: horizontal
              cards:
                - type: custom:button-card
                  name: ' '
                  entity_picture: |
                    [[[
                      return states["sensor.gwmbrasil_${VEICULO}_imagem_do_veiculo"].state;
                    ]]]
                  show_entity_picture: true
                  tap_action:
                    action: none
                  hold_action:
                    action: none
                  size: 400px
                  styles:
                    card:
                      - background: rgba(0,0,0,0)
                      - border: 0
                      - box-shadow: none
                      - position: absolute
                  card_mod:
                    style: |
                      /* === CONT√äINER PRINCIPAL === */
                      ha-card {
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        width: 100%;
                        height: 100%;
                        transform: translateZ(0);
                        isolation: isolate;
                      }

                      #img-cell {
                        display: flex !important;
                        justify-content: center !important;
                        align-items: center !important;
                        width: 100%;
                        height: 100%;
                        position: relative;
                      }

                      #img-cell img {
                        max-width: 100%;
                        max-height: 100%;
                        object-fit: contain;
                        margin: auto;
                        display: block;
                      }

                      @supports (-webkit-touch-callout: none) {
                        #img-cell img {
                          display: none;
                        }

                        #img-cell {
                          background-image: url("{{ states('sensor.gwmbrasil_${VEICULO}_imagem_do_veiculo') }}");
                          background-repeat: no-repeat;
                          background-position: center;
                          background-size: contain;
                        }
                      }
                - type: custom:stack-in-card
                  mode: vertical
                  keep:
                    background: false
                    box_shadow: false
                    border_radius: false
                    margin: false
                    outer_padding: false
                  card_mod:
                    style: |
                      ha-card {
                        background: rgba(0,0,0,0);
                        border: 0px;
                        box-shadow: 0px 0px rgba(0,0,0,0);
                      }
                  cards:
                    - type: conditional
                      conditions:
                        - entity: sensor.gwmbrasil_${VEICULO}_estado_da_carga
                          state: '1'
                      card:
                        type: picture
                        image: /local/images/haval_h6/carga_carregando.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 1.1;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: sensor.gwmbrasil_${VEICULO}_estado_da_carga
                          state: '5'
                      card:
                        type: picture
                        image: /local/images/haval_h6/carga_aguardando.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 1.1;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: sensor.gwmbrasil_${VEICULO}_estado_da_carga
                          state: '4'
                      card:
                        type: picture
                        image: /local/images/haval_h6/carga_naocarregando.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 1.1;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: picture
                      image: /local/images/haval_h6/h6.png
                      tap_action:
                        action: none
                      hold_action:
                        action: none
                      card_mod:
                        style: |
                          :host {
                            z-index: 3;
                            position: relative;
                          }
                          ha-card {
                            max-width: 441px;
                            max-height: 400px;
                            border: 0px;
                            background: rgba(0,0,0,0);
                          }
                          img {
                            max-width: 100%;
                            max-height: 100%;
                            object-fit: contain;
                          }
                    - type: conditional
                      conditions:
                        - entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_estado_do_ar_condicionado
                          state: 'on'
                      card:
                        type: picture
                        image: /local/images/haval_h6/ac_direita.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 6;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_estado_do_ar_condicionado
                          state: 'on'
                      card:
                        type: picture
                        image: /local/images/haval_h6/ac_esquerda.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 6;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_porta_dianteira_direita
                          state: 'on'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/porta_dianteira_direita_aberta.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 4;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_porta_dianteira_direita
                          state: 'off'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/porta_dianteira_direita_fechada.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 4;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_porta_dianteira_esquerda
                          state: 'on'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/porta_dianteira_esquerda_aberta.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 4;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_porta_dianteira_esquerda
                          state: 'off'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/porta_dianteira_esquerda_fechada.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 4;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: binary_sensor.gwmbrasil_${VEICULO}_porta_malas
                          state: 'on'
                      card:
                        type: picture
                        image: /local/images/haval_h6/porta_malas.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 4;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_porta_traseira_direita
                          state: 'on'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/porta_traseira_direita_aberta.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 4;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_porta_traseira_direita
                          state: 'off'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/porta_traseira_direita_fechada.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 4;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_porta_traseira_esquerda
                          state: 'on'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/porta_traseira_esquerda_aberta.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 4;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_porta_traseira_esquerda
                          state: 'off'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/porta_traseira_esquerda_fechada.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 4;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: sensor.gwmbrasil_${VEICULO}_posicao_do_teto_solar
                          state_not: '3'
                      card:
                        type: picture
                        image: /local/images/haval_h6/teto_solar_aberto.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 4;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: binary_sensor.gwmbrasil_${VEICULO}_estado_da_trava
                          state: 'off'
                      card:
                        type: picture
                        image: /local/images/haval_h6/trava.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 2;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_estado_do_ar_condicionado
                          state: 'on'
                      card:
                        type: picture
                        image: /local/images/haval_h6/ventilacao.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 5;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: sensor.gwmbrasil_${VEICULO}_vidro_dianteiro_direito
                          state: '2'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/vidro_dianteiro_direito_aberto.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 6;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: sensor.gwmbrasil_${VEICULO}_vidro_dianteiro_direito
                          state: '3'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/vidro_dianteiro_direito_entreaberto.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 5;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: sensor.gwmbrasil_${VEICULO}_vidro_dianteiro_esquerdo
                          state: '2'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/vidro_dianteiro_esquerdo_aberto.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 6;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: sensor.gwmbrasil_${VEICULO}_vidro_dianteiro_esquerdo
                          state: '3'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/vidro_dianteiro_esquerdo_entreaberto.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 5;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: sensor.gwmbrasil_${VEICULO}_vidro_traseiro_direito
                          state: '2'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/vidro_traseiro_direito_aberto.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 6;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: sensor.gwmbrasil_${VEICULO}_vidro_traseiro_direito
                          state: '3'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/vidro_traseiro_direito_entreaberto.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 5;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: sensor.gwmbrasil_${VEICULO}_vidro_traseiro_esquerdo
                          state: '2'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/vidro_traseiro_esquerdo_aberto.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 6;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
                    - type: conditional
                      conditions:
                        - entity: sensor.gwmbrasil_${VEICULO}_vidro_traseiro_esquerdo
                          state: '3'
                      card:
                        type: picture
                        image: >-
                          /local/images/haval_h6/vidro_traseiro_esquerdo_entreaberto.png
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            :host {
                              position: absolute;
                              top: 0;
                              left: 0;
                              z-index: 5;
                            }
                            ha-card {
                              max-width: 441px;
                              max-height: 400px;
                              border: 0px;
                              background: rgba(0,0,0,0);
                            }
                            img {
                              max-width: 100%;
                              max-height: 100%;
                              object-fit: contain;
                            }
              card_mod:
                style: |
                  ha-card {
                    display: flex;
                    border: 0px;
                    justify-content: center;
                    align-items: center;
                    background: none !important /*bg*/;
                    border-radius: 6px;
                  }
            - type: markdown
              content: >
                {% set raw =
                states('sensor.gwmbrasil_${VEICULO}_status_message') %}         
                {% if raw in ['unknown','unavailable','', None] %}
                  {% set mensagens = [] %}
                {% else %}
                  {% set mensagens = raw.split('|') %}
                {% endif %}

                {% set textos = {
                  "NO_ALERTS": "N√£o h√° alertas neste momento.",
                  "ERR_FORMATTING_ADDRESS": "Erro ao formatar endere√ßo.",
                  "ERR_GENERATE_RESPONSE": "Desculpe, houve um erro ao gerar a resposta.",
                  "ALERT_HIGH_VOLTAGE_DISCONNECT": "A bateria de alta tens√£o j√° est√° totalmente carregada. O carregador deve ser desconectado.",
                  "SUNROOF_OPEN": "O teto solar est√° aberto.",
                  "UNLOCKED": "A trava das portas n√£o est√° acionada e o ve√≠culo pode ser aberto.",
                  "ENGINE_ON_AND_UNLOCKED": "O motor est√° ligado e o ve√≠culo est√° destravado. Verifique se n√£o foi esquecido ligado.",
                  "FUEL_LOW": "N√≠vel de combust√≠vel abaixo de 15 litros. Recomenda-se abastecer.",
                  "AC_ON_WITH_ENGINE_OFF": "O ar-condicionado est√° ligado com o ve√≠culo desligado. Isso pode drenar a bateria de 12V.",
                  "REVIEW_PREFIX": "Seu ve√≠culo est√° dentro do limite padr√£o de quilometragem para agendar a revis√£o."
                } %}

                {% for item in mensagens %}
                  {% set partes = item.split('@') %}
                  {% set codigo = partes[0] | trim %}
                  {% if codigo in textos %}
                  ‚Ä¢ {{ textos.get(codigo) }}
                  {% elif codigo == 'VEHICLE_CHARGING_TIME' and partes|length >= 2 %}
                  ‚Ä¢ O ve√≠culo est√° carregando. Tempo aproximado para carga total: {{ partes[1] }}.
                  {% elif codigo == 'WINDOW_OPEN' and partes|length >= 2 %}
                  ‚Ä¢ O {{ partes[1] }} est√° aberto.
                  {% elif codigo == 'DOOR_OPEN' and partes|length >= 2 %}
                  ‚Ä¢ A {{ partes[1] }} est√° aberta.
                  {% elif codigo == 'TRUNK_OPEN' and partes|length >= 2 %}
                  ‚Ä¢ O {{ partes[1] }} est√° aberto.
                  {% elif codigo == 'BATTERY_12V_CRITICAL' and partes|length >= 2 %}
                  ‚Ä¢ üî¥ Alerta cr√≠tico: bateria 12V em {{ partes[1] }}%. Ligue o motor o quanto antes.
                  {% elif codigo == 'BATTERY_12V_ALERT' and partes|length >= 2 %}
                  ‚Ä¢ üü† Aten√ß√£o: bateria 12V em {{ partes[1] }}%.
                  {% elif codigo == 'TIRE_PRESSURE' and partes|length >= 4 %}
                  ‚Ä¢ A {{ partes[1] }} est√° em {{ partes[2] }} psi com temperatura de {{ partes[3] }}.
                  {% elif codigo == 'TIRE_PRESSURE_DEFAULTS' and partes|length >= 3 %}
                  ‚Ä¢ A press√£o recomendada pela montadora √© entre {{ partes[1] }} e {{ partes[2] }} psi.
                  {% elif codigo == 'SERVICE_WITH_TOLERANCE' and partes|length >= 2 %}
                  ‚Ä¢ Ve√≠culo no limite para revis√£o. Restam {{ partes[1] }} km antes da perda da garantia.
                  {% else %}
                  ‚Ä¢ {{ item }}
                  {% endif %}

                {% endfor %}
              card_mod:
                style: |
                  ha-card {
                    background: rgba(30, 35, 45, 0.4);
                    backdrop-filter: blur(20px);
                    border-radius: 6px;
                    padding: 16px;
                    color: rgba(255,255,255,0.7);
                    font-size: 14px;
                    text-align: center;
                    display: {% if states('sensor.gwmbrasil_${VEICULO}_status_message') in
                      ['NO_ALERTS','N√£o h√° alertas neste momento.','unknown','unavailable',''] %}
                      none
                    {% else %}
                      block
                    {% endif %} !important;
                  }
            - type: custom:button-card
              name: Controles
              icon: mdi:car-cog
              show_name: true
              show_icon: true
              tap_action:
                action: navigate
                navigation_path: controles
              card_mod:
                style: |
                  ha-card {
                    background: none !important /*bg*/;
                    border-radius: 6px;
                    animation:pulse 2s infinite;
                  }
              styles:
                icon:
                  - width: 28px
                name:
                  - font-size: 14px
            - type: custom:stack-in-card
              mode: horizontal
              cards:
                - type: custom:mushroom-title-card
                  title: >-
                    {{ states("sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo")
                    }}
                  subtitle: '{{ states("sensor.gwmbrasil_${VEICULO}_cor_do_veiculo") }}'
                  title_tap_action:
                    action: none
                  subtitle_tap_action:
                    action: none
              card_mod:
                style: |
                  ha-card {
                    display: flex;
                    justify-content: center !important;
                    align-items: center !important;
                    background: none !important /*bg*/;
                    border-radius: 6px;
                  }
            - type: horizontal-stack
              cards:
                - type: custom:bar-card
                  title: Bateria
                  positions:
                    icon: 'off'
                    name: 'off'
                  tap_action:
                    action: more-info
                  hold_action:
                    action: none
                  min: 0
                  max: 100
                  severity:
                    - value: 0
                      color: '#540000'
                    - value: 50
                      color: '#ffa200'
                    - value: 100
                      color: '#009c72'
                  entities:
                    - entity: sensor.gwmbrasil_${VEICULO}_estado_de_carga_soc
                  card_mod:
                    style: |
                      :host {
                        {% set modelo = states('sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo').split(' ') %}
                        {% if 'HEV' in modelo  or 'TANK' in modelo %}
                          display: none
                        {% endif %} !important;                
                      }
                      ha-card {
                        background: none !important /*bg*/;
                        border-radius: 6px;
                      }
                - type: custom:bar-card
                  title: Combust√≠vel
                  positions:
                    icon: 'off'
                    name: 'off'
                  tap_action:
                    action: more-info
                  hold_action:
                    action: none
                  min: 0
                  max: 60
                  severity:
                    - value: 0
                      color: '#540000'
                    - value: 30
                      color: '#ffa200'
                    - value: 55
                      color: '#009c72'
                  entities:
                    - entity: sensor.gwmbrasil_${VEICULO}_nivel_de_combustivel
                  card_mod:
                    style: |
                      :host {
                        {% set modelo = states('sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo').split(' ') %}
                        {% if 'HAVAL' not in modelo %}
                          display: none
                        {% endif %} !important;
                      }              
                      ha-card {
                        background: none !important /*bg*/;
                        border-radius: 6px;
                      }
                - type: custom:bar-card
                  title: Autonomia EV
                  positions:
                    icon: 'off'
                    name: 'off'
                  tap_action:
                    action: more-info
                  hold_action:
                    action: none
                  min: 0
                  max: 100
                  severity:
                    - value: 0
                      color: '#540000'
                    - value: 50
                      color: '#ffa200'
                    - value: 100
                      color: '#009c72'
                  entities:
                    - entity: sensor.gwmbrasil_${VEICULO}_autonomia_ev
                  card_mod:
                    style: |
                      :host {
                        {% set modelo = states('sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo').split(' ') %}
                        {% if 'TANK' not in modelo  %}
                          display: none
                        {% endif %} !important;
                      }
                      ha-card {
                        background: none !important /*bg*/;
                        border-radius: 6px;
                      }
                - type: custom:bar-card
                  title: Autonomia Combust√£o
                  positions:
                    icon: 'off'
                    name: 'off'
                  tap_action:
                    action: more-info
                  hold_action:
                    action: none
                  min: 0
                  max: 800
                  severity:
                    - value: 0
                      color: '#540000'
                    - value: 200
                      color: '#ffa200'
                    - value: 800
                      color: '#009c72'
                  entities:
                    - entity: sensor.gwmbrasil_${VEICULO}_autonomia_combustao
                  card_mod:
                    style: |
                      :host {
                        {% set modelo = states('sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo').split(' ') %}
                        {% if 'TANK' not in modelo %}
                          display: none
                        {% endif %} !important;
                      }
                      ha-card {
                        background: none !important /*bg*/;
                        border-radius: 6px;
                      }
            - type: custom:collapsable-cards
              title: Monitoramento dos pneus
              defaultOpen: true
              cards:
                - type: vertical-stack
                  cards:
                    - type: horizontal-stack
                      cards:
                        - type: custom:mini-graph-card
                          name: Dianteiro Esquerdo
                          entities:
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_pressao_do_pneu_dianteiro_esquerdo
                              name: Press√£o
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_temperatura_do_pneu_dianteiro_esquerdo
                              name: Temperatura
                              show_fill: false
                          icon: mdi:arrow-top-left
                          align_icon: left
                          align_state: center
                          hours_to_show: 48
                          points_per_hour: 0.25
                          tap_action:
                            action: none
                          hold_action:
                            action: none
                          show:
                            fill: true
                          card_mod:
                            style: |
                              ha-card {
                                background: none !important /*bg*/;
                                border-radius: 6px;
                              }
                        - type: custom:mini-graph-card
                          name: Dianteiro Direito
                          entities:
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_pressao_do_pneu_dianteiro_direito
                              name: Press√£o
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_temperatura_do_pneu_dianteiro_direito
                              name: Temperatura
                              show_fill: false
                          icon: mdi:arrow-top-right
                          align_icon: left
                          align_state: center
                          hours_to_show: 48
                          points_per_hour: 0.25
                          tap_action:
                            action: none
                          hold_action:
                            action: none
                          show:
                            fill: true
                          card_mod:
                            style: |
                              ha-card {
                                background: none !important /*bg*/;
                                border-radius: 6px;
                              }
                        - type: custom:mini-graph-card
                          name: Traseiro Esquerdo
                          entities:
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_pressao_do_pneu_traseiro_esquerdo
                              name: Press√£o
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_temperatura_do_pneu_traseiro_esquerdo
                              name: Temperatura
                              show_fill: false
                          icon: mdi:arrow-bottom-left
                          align_icon: left
                          align_state: center
                          hours_to_show: 48
                          points_per_hour: 0.25
                          tap_action:
                            action: none
                          hold_action:
                            action: none
                          show:
                            fill: true
                          card_mod:
                            style: |
                              ha-card {
                                background: none !important /*bg*/;
                                border-radius: 6px;
                              }
                        - type: custom:mini-graph-card
                          name: Traseiro Direito
                          entities:
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_pressao_do_pneu_traseiro_direito
                              name: Press√£o
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_temperatura_do_pneu_traseiro_direito
                              name: Temperatura
                              show_fill: false
                          icon: mdi:arrow-bottom-right
                          align_icon: left
                          align_state: center
                          hours_to_show: 48
                          points_per_hour: 0.25
                          tap_action:
                            action: none
                          hold_action:
                            action: none
                          show:
                            fill: true
                          card_mod:
                            style: |
                              ha-card {
                                background: none !important /*bg*/;
                                border-radius: 6px;
                              }
            - type: custom:collapsable-cards
              title: Autonomia e pneus
              defaultOpen: true
              cards:
                - type: horizontal-stack
                  cards:
                    - type: vertical-stack
                      cards:
                        - type: entities
                          entities:
                            - type: custom:template-entity-row
                              entity: sensor.gwmbrasil_${VEICULO}_estado_do_motor
                              name: Estado do motor
                              state: >-
                                ${
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_do_motor'].state
                                === '0' ? 'Desligado' :
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_do_motor'].state
                                === '1' ? 'Ligado' : 'Desconhecido'}
                            - entity: sensor.gwmbrasil_${VEICULO}_quilometragem_total
                              name: Quilometragem total
                            - entity: sensor.gwmbrasil_${VEICULO}_estado_de_carga_12v
                              name: Estado de carga 12V
                              secondary_info: last-updated
                              state_color: true
                              card_mod:
                                style: |
                                  :host {
                                    {% if is_state('sensor.gwmbrasil_${VEICULO}_estado_de_carga_12v','unknown') %} display: none !important {% endif %};
                                  }
                            - type: custom:template-entity-row
                              name: Autonomia Total
                              state: |-
                                ${
                                  parseFloat(states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_autonomia_combustao'].state) +
                                  parseFloat(states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_autonomia_ev'].state) + " km"
                                  ;
                                }
                              stateq: >-
                                {{ (
                                (states('sensor.gwmbrasil_${VEICULO}_autonomia_combustao')
                                | float(0)) +
                                (states('sensor.gwmbrasil_${VEICULO}_autonomia_ev')
                                | float(0)) ) | round(2) }} km
                              icon: mdi:numeric
                              card_mod:
                                style: |
                                  :host {
                                    {% set modelo = states('sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo').split(' ') %}
                                    {% if 'PHEV' not in modelo %}
                                      display: none
                                    {% endif %} !important;
                                  }
                            - entity: sensor.gwmbrasil_${VEICULO}_autonomia_combustao
                              name: Autonomia Combust√£o
                              card_mod:
                                style: |
                                  :host {
                                    {% set modelo = states('sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo').split(' ') %}
                                    {% if 'ORA' in modelo %}
                                      display: none
                                    {% endif %} !important;
                                  }
                                  ha-card {
                                    border-width: 0px !important;
                                    background: none
                                  }
                            - entity: sensor.gwmbrasil_${VEICULO}_nivel_de_combustivel
                              name: N√≠vel de combust√≠vel
                              card_mod:
                                style: |
                                  :host {
                                    {% set modelo = states('sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo').split(' ') %}
                                    {% if 'HAVAL' not in modelo %}
                                      display: none
                                    {% endif %} !important;
                                  }
                                  ha-card {
                                    border-width: 0px !important;
                                    background: none
                                  }
                            - entity: sensor.gwmbrasil_${VEICULO}_autonomia_ev
                              name: Autonomia EV
                            - entity: sensor.gwmbrasil_${VEICULO}_estado_de_carga_soc
                              name: Estado de carga (SoC)
                              state_color: true
                            - type: custom:template-entity-row
                              entity: sensor.gwmbrasil_${VEICULO}_estado_da_carga
                              name: Estado de Carregamento
                              state: >-
                                ${
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_da_carga'].state
                                === '0' ? 'Desconectado' :
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_da_carga'].state
                                === '1' ? 'Carregando' :
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_da_carga'].state
                                === '2' ? 'Programado' :
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_da_carga'].state
                                === '3' ? 'Finalizado' :
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_da_carga'].state
                                === '5' ? 'Aguardando libera√ß√£o' :
                                'Desconhecido' }
                            - entity: >-
                                binary_sensor.gwmbrasil_${VEICULO}_agendamento_de_carga
                              name: Agendamento de carga
                              state: >-
                                ${
                                states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_agendamento_de_carga'].state
                                === 'off' ? 'Sem agendamento' :
                                states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_agendamento_de_carga'].state
                                === 'on' ? 'Carregamento programado' :
                                'Desconhecido'}
                              card_mod:
                                style: |
                                  :host {
                                    display: {% if is_state('sensor.gwmbrasil_${VEICULO}_agendamento_de_carga','on') %} block {% else %} none {% endif %};
                                  }
                            - entity: sensor.gwmbrasil_${VEICULO}_tempo_de_carga
                              name: Tempo de carga
                              card_mod:
                                style: |
                                  :host {
                                    display: {% if is_state('sensor.gwmbrasil_${VEICULO}_estado_da_carga','1') %} block {% else %} none {% endif %};
                                  }
                            - type: custom:mushroom-template-card
                              primary: Interromper carregamento
                              icon: mdi:ev-plug-type2
                              entity: >-
                                button.gwmbrasil_${VEICULO}_interromper_carregamento
                              hold_action:
                                action: none
                              tap_action:
                                action: toggle
                                confirmation:
                                  text: >-
                                    Tem certeza de que deseja interromper o
                                    carregamento?
                              card_mod:
                                style: |
                                  :host {
                                    display: {% if states('sensor.gwmbrasil_${VEICULO}_estado_da_carga') in ['1','5'] %} block {% else %} none {% endif %};
                                  }
                          card_mod:
                            style: |
                              ha-card {
                                background: none !important /*bg*/;
                                border-radius: 6px;
                              }
                    - type: vertical-stack
                      cards:
                        - type: entities
                          entities:
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_pressao_do_pneu_dianteiro_esquerdo
                              name: Press√£o do Pneu Dianteiro Esquerdo
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_temperatura_do_pneu_dianteiro_esquerdo
                              name: Temperatura do Pneu Dianteiro Esquerdo
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_pressao_do_pneu_dianteiro_direito
                              name: Press√£o do Pneu Dianteiro Direito
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_temperatura_do_pneu_dianteiro_direito
                              name: Temperatura do Pneu Dianteiro Direito
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_pressao_do_pneu_traseiro_esquerdo
                              name: Press√£o do Pneu Traseiro Esquerdo
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_temperatura_do_pneu_traseiro_esquerdo
                              name: Temperatura do Pneu Traseiro Esquerdo
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_pressao_do_pneu_traseiro_direito
                              name: Press√£o do Pneu Traseiro Direito
                            - entity: >-
                                sensor.gwmbrasil_${VEICULO}_temperatura_do_pneu_traseiro_direito
                              name: Temperatura do Pneu Traseiro Direito
                          card_mod:
                            style: |
                              ha-card {
                                background: none !important /*bg*/;
                                border-radius: 6px;
                              }
              card_mod:
                style: |
                  ha-card {
                    border-width: 5px !important;
                    background: none
                  }
            - type: custom:collapsable-cards
              title: Climatiza√ß√£o
              defaultOpen: true
              cards:
                - type: entities
                  entities:
                    - entity: sensor.gwmbrasil_${VEICULO}_temperatura_da_cabine
                      name: Temperatura da cabine
                    - type: custom:template-entity-row
                      entity: >-
                        binary_sensor.gwmbrasil_${VEICULO}_estado_do_ar_condicionado
                      name: Ar Condicionado
                      state: >-
                        ${
                        states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_do_ar_condicionado'].state
                        === 'off' ? 'Desligado' :
                        states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_do_ar_condicionado'].state
                        === 'on' ? 'Ligado' : 'Desconhecido'}
                    - type: custom:mushroom-template-card
                      primary: Ligar A/C
                      icon: mdi:fan-clock
                      secondary: Acionar por 15 minutos em 18¬∞C
                      entity: button.gwmbrasil_${VEICULO}_ativacao_do_ar_condicionado
                      hold_action:
                        action: none
                      tap_action:
                        action: toggle
                        confirmation:
                          text: >-
                            Tem certeza de que deseja ligar o ar condicionado? O
                            ve√≠culo tem que estar trancado, desligado e, para
                            modelos PHEV, n√£o pode estar em carregamento ou com
                            o plugue conectado.
                      card_mod:
                        style: >
                          :host {
                            display: ${
                          states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_do_ar_condicionado'].state

                          === 'on' ? 'none' :

                          states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_da_trava'].state

                          === 'on' ? 'none' :

                          states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_do_motor'].state

                          === '1' ? 'none' : 'block' }
                    - type: custom:template-entity-row
                      entity: >-
                        binary_sensor.gwmbrasil_${VEICULO}_estado_do_purificador_de_ar
                      name: Purificador de ar
                      state: >-
                        ${
                        states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_do_purificador_de_ar'].state
                        === 'off' ? 'Desligado' :
                        states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_do_purificador_de_ar'].state
                        === 'on' ? 'Ligado' : 'Desconhecido'}
                      card_mod:
                        style: |
                          :host {
                            {% set modelo = states('sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo').split(' ') %}
                            {% if 'TANK' in modelo %}
                              display: none
                            {% endif %} !important;
                          }              
                  card_mod:
                    style: |
                      ha-card {
                        background: none !important /*bg*/;
                        border-radius: 6px;
                      }
                - type: entities
                  entities:
                    - entity: binary_sensor.gwmbrasil_${VEICULO}_aquecimento_da_cabine
                      name: Aquecimento da cabine
                    - entity: >-
                        binary_sensor.gwmbrasil_${VEICULO}_aquecimento_do_banco_do_motorista
                      name: Aquecimento do banco do motorista
                    - entity: >-
                        binary_sensor.gwmbrasil_${VEICULO}_aquecimento_do_banco_do_passageiro
                      name: Aquecimento do banco do passageiro
                    - entity: >-
                        binary_sensor.gwmbrasil_${VEICULO}_aquecimento_do_volante
                      name: Aquecimento do banco do volante
                  card_mod:
                    style: |
                      :host {
                        {% set modelo = states('sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo').split(' ') %}
                        {% if 'TANK' not in modelo %}
                          display: none
                        {% endif %} !important;
                      }
                      ha-card {
                        background: none !important /*bg*/;
                        border-radius: 6px;
                      }
            - type: custom:collapsable-cards
              title: Portas e vidros
              defaultOpen: true
              cards:
                - type: horizontal-stack
                  cards:
                    - type: entities
                      entities:
                        - type: custom:template-entity-row
                          entity: binary_sensor.gwmbrasil_${VEICULO}_estado_da_trava
                          name: Trava das portas
                          color: >-
                            ${
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_da_trava'].state
                            === 'on' ? 'red' : '' }
                          icon: >-
                            ${
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_da_trava'].state
                            === 'off' ? 'mdi:car-door-lock' :
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_da_trava'].state
                            === 'on' ? 'mdi:car-door-lock-open' :
                            'mdi:cloud-question' }
                          state: >-
                            ${
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_da_trava'].state
                            === 'off' ? 'Trancada' :
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_estado_da_trava'].state
                            === 'on' ? 'Destrancada' : 'Desconhecido'}
                        - type: custom:template-entity-row
                          entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_porta_dianteira_esquerda
                          name: Dianteira esquerda
                          color: >-
                            ${
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_dianteira_esquerda'].state
                            === 'on' ? 'red' : '' }
                          state: >-
                            ${
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_dianteira_esquerda'].state
                            === 'off' ? 'Fechada' :
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_dianteira_esquerda'].state
                            === 'on' ? 'Aberta' : 'Desconhecido'}
                        - type: custom:template-entity-row
                          entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_porta_dianteira_direita
                          name: Dianteira direita
                          color: >-
                            ${
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_dianteira_direita'].state
                            === 'on' ? 'red' : '' }
                          state: >-
                            ${
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_dianteira_direita'].state
                            === 'off' ? 'Fechada' :
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_dianteira_direita'].state
                            === 'on' ? 'Aberta' :
                            'Desconhecido'}                
                        - type: custom:template-entity-row
                          entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_porta_traseira_esquerda
                          name: Traseira esquerda
                          color: >-
                            ${
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_traseira_esquerda'].state
                            === 'on' ? 'red' : '' }
                          state: >-
                            ${
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_traseira_esquerda'].state
                            === 'off' ? 'Fechada' :
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_traseira_esquerda'].state
                            === 'on' ? 'Aberta' : 'Desconhecido'}
                        - type: custom:template-entity-row
                          entity: >-
                            binary_sensor.gwmbrasil_${VEICULO}_porta_traseira_direita
                          name: Traseira direita
                          color: >-
                            ${
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_traseira_direita'].state
                            === 'on' ? 'red' : '' }
                          state: >-
                            ${
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_traseira_direita'].state
                            === 'off' ? 'Fechada' :
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_traseira_direita'].state
                            === 'on' ? 'Aberta' : 'Desconhecido'}
                        - type: custom:template-entity-row
                          entity: binary_sensor.gwmbrasil_${VEICULO}_porta_malas
                          name: Porta malas
                          state: >-
                            ${
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_malas'].state
                            === 'off' ? 'Fechado' :
                            states['binary_sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_porta_malas'].state
                            === 'on' ? 'Aberto' : 'Desconhecido'}
                      state_color: false
                      card_mod:
                        style: |
                          ha-card {
                            background: none !important /*bg*/;
                            border-radius: 6px;
                          }
                    - type: vertical-stack
                      cards:
                        - type: entities
                          entities:
                            - type: custom:template-entity-row
                              entity: >-
                                sensor.gwmbrasil_${VEICULO}_vidro_dianteiro_esquerdo
                              name: Dianteiro esquerdo
                              color: >-
                                ${
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_dianteiro_esquerdo'].state
                                !== '1' ? 'red' : '' }
                              state: >-
                                ${
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_dianteiro_esquerdo'].state
                                === '1' ? 'Fechado' :
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_dianteiro_esquerdo'].state
                                === '2' ? 'Aberto' :
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_dianteiro_esquerdo'].state
                                === '3' ? 'Entreaberto' : 'Desconhecido' }
                            - type: custom:template-entity-row
                              entity: >-
                                sensor.gwmbrasil_${VEICULO}_vidro_dianteiro_direito
                              name: Dianteiro direito
                              color: >-
                                ${
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_dianteiro_direito'].state
                                !== '1' ? 'red' : '' }
                              state: >-
                                ${
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_dianteiro_direito'].state
                                === '1' ? 'Fechado' :
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_dianteiro_direito'].state
                                === '2' ? 'Aberto' :
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_dianteiro_direito'].state
                                === '3' ? 'Entreaberto' : 'Desconhecido' }
                            - type: custom:template-entity-row
                              entity: >-
                                sensor.gwmbrasil_${VEICULO}_vidro_traseiro_esquerdo
                              name: Traseiro esquerdo
                              color: >-
                                ${
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_traseiro_esquerdo'].state
                                !== '1' ? 'red' : '' }
                              state: >-
                                ${
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_traseiro_esquerdo'].state
                                === '1' ? 'Fechado' :
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_traseiro_esquerdo'].state
                                === '2' ? 'Aberto' :
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_traseiro_esquerdo'].state
                                === '3' ? 'Entreaberto' : 'Desconhecido' }
                            - type: custom:template-entity-row
                              entity: >-
                                sensor.gwmbrasil_${VEICULO}_vidro_traseiro_direito
                              name: Traseiro direito
                              color: >-
                                ${
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_traseiro_direito'].state
                                !== '1' ? 'red' : '' }
                              state: >-
                                ${
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_traseiro_direito'].state
                                === '1' ? 'Fechado' :
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_traseiro_direito'].state
                                === '2' ? 'Aberto' :
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_vidro_traseiro_direito'].state
                                === '3' ? 'Entreaberto' : 'Desconhecido' }
                          card_mod:
                            style: |
                              ha-card {
                                background: none !important /*bg*/;
                                border-radius: 6px;
                              }
                        - type: entities
                          entities:
                            - type: custom:template-entity-row
                              entity: >-
                                sensor.gwmbrasil_${VEICULO}_posicao_do_teto_solar
                              name: Teto Solar
                              state: >-
                                ${
                                states['sensor.gwmbrasil_'+VEICULO.toLowerCase()+'_posicao_do_teto_solar'].state
                                === '3' ? 'Fechado' : 'Aberto'}
                            - type: custom:bar-card
                              entity: >-
                                sensor.gwmbrasil_${VEICULO}_posicao_do_teto_solar
                              name: Teto Solar
                              tap_action:
                                action: none
                              hold_action:
                                action: none
                              min: 0
                              max: 100
                              unit_of_measurement: '%'
                              severity:
                                - value: 0
                                  color: '#009c72'
                                - value: 50
                                  color: '#ffa200'
                                - value: 100
                                  color: '#540000'
                              card_mod:
                                style: |
                                  :host {
                                    display: {% if is_state('sensor.gwmbrasil_${VEICULO}_posicao_do_teto_solar','3') %} none {% elif states('sensor.gwmbrasil_${VEICULO}_posicao_do_teto_solar') is none %} none {% else %} block {% endif %};
                                  }
                                  ha-card {
                                    border-width: 0px !important;
                                    background: none;
                                  }
                          card_mod:
                            style: |
                              :host {
                                {% if is_state('sensor.gwmbrasil_${VEICULO}_posicao_do_teto_solar','unknown') %} display: none !important {% endif %};
                              }
                              ha-card {
                                background: none !important /*bg*/;
                                border-radius: 6px;
                              }
            - type: conditional
              conditions:
                - entity: device_tracker.gwmbrasil_${VEICULO}
                  state_not: unavailable
              card:
                type: custom:collapsable-cards
                title: Mapa
                defaultOpen: true
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.gwmbrasil_${VEICULO}_endereco_atual
                    name: ' '
                  - type: map
                    entities:
                      - entity: device_tracker.gwmbrasil_${VEICULO}
                    theme_mode: dark
                    default_zoom: 16
                    hours_to_show: 30
                    auto_fit: true
                    aspect_ratio: '16:9'
                    card_mod:
                      style: |
                        ha-card {                  
                          border-radius: 6px;
                        }
  - type: panel
    path: controles
    title: Controles
    icon: mdi:camera-control
    cards:
      - type: custom:config-template-card
        entities:
          - select.gwmbrasil_veiculos_registrados
          - binary_sensor.gwmbrasil_${VEICULO}_estado_da_trava
          - binary_sensor.gwmbrasil_${VEICULO}_estado_do_ar_condicionado
          - binary_sensor.gwmbrasil_${VEICULO}_estado_do_purificador_de_ar
          - binary_sensor.gwmbrasil_${VEICULO}_porta_dianteira_direita
          - binary_sensor.gwmbrasil_${VEICULO}_porta_dianteira_esquerda
          - binary_sensor.gwmbrasil_${VEICULO}_porta_malas
          - binary_sensor.gwmbrasil_${VEICULO}_porta_traseira_direita
          - binary_sensor.gwmbrasil_${VEICULO}_porta_traseira_esquerda
          - sensor.gwmbrasil_${VEICULO}_estado_do_motor
          - sensor.gwmbrasil_${VEICULO}_status_message
          - sensor.gwmbrasil_${VEICULO}_posicao_do_teto_solar
          - sensor.gwmbrasil_${VEICULO}_vidro_dianteiro_direito
          - sensor.gwmbrasil_${VEICULO}_vidro_dianteiro_esquerdo
          - sensor.gwmbrasil_${VEICULO}_vidro_traseiro_direito
          - sensor.gwmbrasil_${VEICULO}_vidro_traseiro_esquerdo
        card:
          type: vertical-stack
          cards:
            - type: markdown
              content: >
                {% set raw =
                states('sensor.gwmbrasil_${VEICULO}_status_message') %}         
                {% if raw in ['unknown','unavailable','', None] %}
                  {% set mensagens = [] %}
                {% else %}
                  {% set mensagens = raw.split('|') %}
                {% endif %}

                {% set textos = {
                  "NO_ALERTS": "N√£o h√° alertas neste momento.",
                  "ERR_FORMATTING_ADDRESS": "Erro ao formatar endere√ßo.",
                  "ERR_GENERATE_RESPONSE": "Desculpe, houve um erro ao gerar a resposta.",
                  "ALERT_HIGH_VOLTAGE_DISCONNECT": "A bateria de alta tens√£o j√° est√° totalmente carregada. O carregador deve ser desconectado.",
                  "SUNROOF_OPEN": "O teto solar est√° aberto.",
                  "UNLOCKED": "A trava das portas n√£o est√° acionada e o ve√≠culo pode ser aberto.",
                  "ENGINE_ON_AND_UNLOCKED": "O motor est√° ligado e o ve√≠culo est√° destravado. Verifique se n√£o foi esquecido ligado.",
                  "FUEL_LOW": "N√≠vel de combust√≠vel abaixo de 15 litros. Recomenda-se abastecer.",
                  "AC_ON_WITH_ENGINE_OFF": "O ar-condicionado est√° ligado com o ve√≠culo desligado. Isso pode drenar a bateria de 12V.",
                  "REVIEW_PREFIX": "Seu ve√≠culo est√° dentro do limite padr√£o de quilometragem para agendar a revis√£o."
                } %}

                {% for item in mensagens %}
                  {% set partes = item.split('@') %}
                  {% set codigo = partes[0] | trim %}
                  {% if codigo in textos %}
                  ‚Ä¢ {{ textos.get(codigo) }}
                  {% elif codigo == 'VEHICLE_CHARGING_TIME' and partes|length >= 2 %}
                  ‚Ä¢ O ve√≠culo est√° carregando. Tempo aproximado para carga total: {{ partes[1] }}.
                  {% elif codigo == 'WINDOW_OPEN' and partes|length >= 2 %}
                  ‚Ä¢ O {{ partes[1] }} est√° aberto.
                  {% elif codigo == 'DOOR_OPEN' and partes|length >= 2 %}
                  ‚Ä¢ A {{ partes[1] }} est√° aberta.
                  {% elif codigo == 'TRUNK_OPEN' and partes|length >= 2 %}
                  ‚Ä¢ O {{ partes[1] }} est√° aberto.
                  {% elif codigo == 'BATTERY_12V_CRITICAL' and partes|length >= 2 %}
                  ‚Ä¢ üî¥ Alerta cr√≠tico: bateria 12V em {{ partes[1] }}%. Ligue o motor o quanto antes.
                  {% elif codigo == 'BATTERY_12V_ALERT' and partes|length >= 2 %}
                  ‚Ä¢ üü† Aten√ß√£o: bateria 12V em {{ partes[1] }}%.
                  {% elif codigo == 'TIRE_PRESSURE' and partes|length >= 4 %}
                  ‚Ä¢ A {{ partes[1] }} est√° em {{ partes[2] }} psi com temperatura de {{ partes[3] }}.
                  {% elif codigo == 'TIRE_PRESSURE_DEFAULTS' and partes|length >= 3 %}
                  ‚Ä¢ A press√£o recomendada pela montadora √© entre {{ partes[1] }} e {{ partes[2] }} psi.
                  {% elif codigo == 'SERVICE_WITH_TOLERANCE' and partes|length >= 2 %}
                  ‚Ä¢ Ve√≠culo no limite para revis√£o. Restam {{ partes[1] }} km antes da perda da garantia.
                  {% else %}
                  ‚Ä¢ {{ item }}
                  {% endif %}

                {% endfor %}
              card_mod:
                style: |
                  ha-card {
                    background: rgba(30, 35, 45, 0.4);
                    backdrop-filter: blur(20px);
                    border-radius: 6px;
                    padding: 16px;
                    color: rgba(255,255,255,0.7);
                    font-size: 14px;
                    text-align: center;
                    display: {% if states('sensor.gwmbrasil_${VEICULO}_status_message') in
                      ['NO_ALERTS','N√£o h√° alertas neste momento.','unknown','unavailable',''] %}
                      none
                    {% else %}
                      block
                    {% endif %} !important;
                  }
            - type: custom:button-card
              name: MOTOR
              show_icon: false
              show_name: true
              show_state: false
              entity: sensor.gwmbrasil_${VEICULO}_estado_do_motor
              styles:
                card:
                  - background: transparent
                  - box-shadow: none
                  - padding: 8px 8px 0 8px
                name:
                  - font-size: 11px
                  - font-weight: '500'
                  - letter-spacing: 1px
                  - color: rgba(255,255,255,0.4)
                  - justify-self: start
                grid:
                  - grid-template-areas: '"n status"'
                  - grid-template-columns: 1fr auto
              custom_fields:
                status: |
                  [[[            
                    const status = states[`sensor.gwmbrasil_${VEICULO}_estado_do_motor`].state;
                    if (status === 'none') return '';
                    const isOn = status === '1';
                    const color = isOn ? '#f87171' : '#4ade80';
                    const text = isOn ? 'Ligado' : 'Desligado';
                    return `<span style="display:flex;align-items:center;gap:6px;">
                      <span style="width:6px;height:6px;border-radius:50%;background:${color};animation:pulse 2s infinite;"></span>
                      <span style="font-size:11px;color:${color};">${text}</span>
                    </span>`;
                  ]]]
            - type: horizontal-stack
              cards:
                - type: custom:button-card
                  entity: button.gwmbrasil_${VEICULO}_ligar_o_motor
                  name: Ligar
                  icon: mdi:power
                  tap_action:
                    action: call-service
                    service: button.press
                    service_data:
                      entity_id: button.gwmbrasil_${VEICULO}_ligar_o_motor
                  styles:
                    card:
                      - background: rgba(30, 35, 45, 0.4)
                      - backdrop-filter: blur(10px)
                      - border: 1px solid rgba(255,255,255,0.08)
                      - border-radius: 16px
                      - padding: 20px
                      - transition: all 0.3s ease
                    card:hover:
                      - border-color: rgba(74, 222, 128, 0.4)
                      - box-shadow: 0 0 30px rgba(74, 222, 128, 0.1)
                    icon:
                      - color: rgba(255,255,255,0.5)
                      - width: 28px
                      - height: 28px
                    name:
                      - font-size: 13px
                      - color: rgba(255,255,255,0.7)
                      - margin-top: 8px
                  card_mod:
                    style: |
                      :host {
                        padding: 0 0 0 8px 
                      }
                - type: custom:button-card
                  entity: button.gwmbrasil_${VEICULO}_desligar_o_motor
                  name: Desligar
                  icon: mdi:power-off
                  tap_action:
                    action: call-service
                    service: button.press
                    service_data:
                      entity_id: button.gwmbrasil_${VEICULO}_desligar_o_motor
                  styles:
                    card:
                      - background: rgba(30, 35, 45, 0.4)
                      - backdrop-filter: blur(10px)
                      - border: 1px solid rgba(255,255,255,0.08)
                      - border-radius: 16px
                      - padding: 20px
                      - transition: all 0.3s ease
                    card:hover:
                      - border-color: rgba(248, 113, 113, 0.4)
                      - box-shadow: 0 0 30px rgba(248, 113, 113, 0.1)
                    icon:
                      - color: rgba(255,255,255,0.5)
                      - width: 28px
                      - height: 28px
                    name:
                      - font-size: 13px
                      - color: rgba(255,255,255,0.7)
                      - margin-top: 8px
                  card_mod:
                    style: |
                      :host {
                        padding: 0 8px 0 0
                      }
            - type: custom:button-card
              name: PORTAS
              show_icon: false
              entity: binary_sensor.gwmbrasil_${VEICULO}_estado_da_trava
              styles:
                card:
                  - background: transparent
                  - box-shadow: none
                  - padding: 16px 8px 0 8px
                name:
                  - font-size: 11px
                  - font-weight: '500'
                  - letter-spacing: 1px
                  - color: rgba(255,255,255,0.4)
                  - justify-self: start
                grid:
                  - grid-template-areas: '"n status"'
                  - grid-template-columns: 1fr auto
              custom_fields:
                status: |
                  [[[
                    const status = states[`binary_sensor.gwmbrasil_${VEICULO}_estado_da_trava`].state;
                    if (status === 'none') return '';
                    const isOpen = status === 'on';
                    const color = isOpen ? '#f87171' : '#4ade80';
                    const text = isOpen ? 'Abertas' : 'Fechadas';
                    return `<span style="display:flex;align-items:center;gap:6px;">
                      <span style="width:6px;height:6px;border-radius:50%;background:${color};animation:pulse 2s infinite;"></span>
                      <span style="font-size:11px;color:${color};">${text}</span>
                    </span>`;
                  ]]]
            - type: horizontal-stack
              cards:
                - type: custom:button-card
                  entity: button.gwmbrasil_${VEICULO}_abrir_as_portas
                  name: Abrir
                  icon: mdi:car-door
                  tap_action:
                    action: call-service
                    service: button.press
                    service_data:
                      entity_id: button.gwmbrasil_${VEICULO}_abrir_as_portas
                  styles:
                    card:
                      - background: rgba(30, 35, 45, 0.4)
                      - backdrop-filter: blur(10px)
                      - border: 1px solid rgba(255,255,255,0.08)
                      - border-radius: 16px
                      - padding: 20px
                      - transition: all 0.3s ease
                    card:hover:
                      - border-color: rgba(96, 165, 250, 0.4)
                      - box-shadow: 0 0 30px rgba(96, 165, 250, 0.1)
                    icon:
                      - color: rgba(255,255,255,0.5)
                      - width: 28px
                      - height: 28px
                    name:
                      - font-size: 13px
                      - color: rgba(255,255,255,0.7)
                      - margin-top: 8px
                  card_mod:
                    style: |
                      :host {
                        padding: 0 0 0 8px
                      }
                - type: custom:button-card
                  entity: button.gwmbrasil_${VEICULO}_fechar_as_portas
                  name: Fechar
                  icon: mdi:car-door-lock
                  tap_action:
                    action: call-service
                    service: button.press
                    service_data:
                      entity_id: button.gwmbrasil_${VEICULO}_fechar_as_portas
                  styles:
                    card:
                      - background: rgba(30, 35, 45, 0.4)
                      - backdrop-filter: blur(10px)
                      - border: 1px solid rgba(255,255,255,0.08)
                      - border-radius: 16px
                      - padding: 20px
                      - transition: all 0.3s ease
                    card:hover:
                      - border-color: rgba(248, 113, 113, 0.4)
                      - box-shadow: 0 0 30px rgba(248, 113, 113, 0.1)
                    icon:
                      - color: rgba(255,255,255,0.5)
                      - width: 28px
                      - height: 28px
                    name:
                      - font-size: 13px
                      - color: rgba(255,255,255,0.7)
                      - margin-top: 8px
                  card_mod:
                    style: |
                      :host {
                        padding: 0 8px 0 0
                      }
            - type: custom:button-card
              name: PORTA-MALAS
              show_icon: false
              entity: binary_sensor.gwmbrasil_${VEICULO}_porta_malas
              styles:
                card:
                  - background: transparent
                  - box-shadow: none
                  - padding: 16px 8px 0 8px
                name:
                  - font-size: 11px
                  - font-weight: '500'
                  - letter-spacing: 1px
                  - color: rgba(255,255,255,0.4)
                  - justify-self: start
                grid:
                  - grid-template-areas: '"n status"'
                  - grid-template-columns: 1fr auto
              custom_fields:
                status: |
                  [[[
                    const status = states[`binary_sensor.gwmbrasil_${VEICULO}_porta_malas`].state;
                    if (status === 'none') return '';
                    const isOpen = status === 'on';
                    const color = isOpen ? '#f87171' : '#4ade80';
                    const text = isOpen ? 'Aberto' : 'Fechado';
                    return `<span style="display:flex;align-items:center;gap:6px;">
                      <span style="width:6px;height:6px;border-radius:50%;background:${color};animation:pulse 2s infinite;"></span>
                      <span style="font-size:11px;color:${color};">${text}</span>
                    </span>`;
                  ]]]
            - type: horizontal-stack
              cards:
                - type: custom:button-card
                  entity: button.gwmbrasil_${VEICULO}_abrir_porta_malas
                  name: Abrir
                  icon: mdi:car-outline
                  tap_action:
                    action: call-service
                    service: button.press
                    service_data:
                      entity_id: button.gwmbrasil_${VEICULO}_abrir_porta_malas
                  styles:
                    card:
                      - background: rgba(30, 35, 45, 0.4)
                      - backdrop-filter: blur(10px)
                      - border: 1px solid rgba(255,255,255,0.08)
                      - border-radius: 16px
                      - padding: 20px
                      - transition: all 0.3s ease
                    card:hover:
                      - border-color: rgba(251, 191, 36, 0.4)
                      - box-shadow: 0 0 30px rgba(251, 191, 36, 0.1)
                    icon:
                      - color: rgba(255,255,255,0.5)
                      - width: 28px
                      - height: 28px
                    name:
                      - font-size: 13px
                      - color: rgba(255,255,255,0.7)
                      - margin-top: 8px
                  card_mod:
                    style: |
                      :host {
                        padding: 0 0 0 8px
                      }
                - type: custom:button-card
                  entity: button.gwmbrasil_${VEICULO}_fechar_porta_malas
                  name: Fechar
                  icon: mdi:car-back
                  tap_action:
                    action: call-service
                    service: button.press
                    service_data:
                      entity_id: button.gwmbrasil_${VEICULO}_fechar_porta_malas
                  styles:
                    card:
                      - background: rgba(30, 35, 45, 0.4)
                      - backdrop-filter: blur(10px)
                      - border: 1px solid rgba(255,255,255,0.08)
                      - border-radius: 16px
                      - padding: 20px
                      - transition: all 0.3s ease
                    card:hover:
                      - border-color: rgba(248, 113, 113, 0.4)
                      - box-shadow: 0 0 30px rgba(248, 113, 113, 0.1)
                    icon:
                      - color: rgba(255,255,255,0.5)
                      - width: 28px
                      - height: 28px
                    name:
                      - font-size: 13px
                      - color: rgba(255,255,255,0.7)
                      - margin-top: 8px
                  card_mod:
                    style: |
                      :host {
                        padding: 0 8px 0 0
                      }
            - type: custom:button-card
              name: VIDROS
              show_icon: false
              entity: sensor.gwmbrasil_${VEICULO}_vidro_dianteiro_esquerdo
              tap_action:
                action: none
              hold_action:
                action: none
              styles:
                card:
                  - background: transparent
                  - box-shadow: none
                  - padding: 16px 8px 0 8px
                name:
                  - font-size: 11px
                  - font-weight: '500'
                  - letter-spacing: 1px
                  - color: rgba(255,255,255,0.4)
                  - justify-self: start
                grid:
                  - grid-template-areas: '"n status"'
                  - grid-template-columns: 1fr auto
              custom_fields:
                status: |
                  [[[
                    const sensors = [
                      `sensor.gwmbrasil_${VEICULO}_vidro_dianteiro_esquerdo`,
                      `sensor.gwmbrasil_${VEICULO}_vidro_dianteiro_direito`,
                      `sensor.gwmbrasil_${VEICULO}_vidro_traseiro_esquerdo`,
                      `sensor.gwmbrasil_${VEICULO}_vidro_traseiro_direito`
                    ];

                    const values = sensors
                      .map(e => states[e]?.state)
                      .filter(v => v !== undefined && v !== 'none');

                    if (values.length === 0) return '';

                    const anyOpen = values.some(v => v !== '1');

                    const color = anyOpen ? '#f87171' : '#4ade80';
                    const text  = anyOpen ? 'Abertos' : 'Fechados';

                    return `
                      <span style="display:flex;align-items:center;gap:6px;">
                        <span style="
                          width:6px;
                          height:6px;
                          border-radius:50%;
                          background:${color};
                          animation:pulse 2s infinite;
                        "></span>
                        <span style="font-size:11px;color:${color};">
                          ${text}
                        </span>
                      </span>
                    `;
                  ]]]
            - type: horizontal-stack
              cards:
                - type: custom:button-card
                  entity: button.gwmbrasil_${VEICULO}_abrir_os_vidros
                  name: Abrir
                  icon: mdi:car-windshield-outline
                  tap_action:
                    action: call-service
                    service: button.press
                    service_data:
                      entity_id: button.gwmbrasil_${VEICULO}_abrir_os_vidros
                  styles:
                    card:
                      - background: rgba(30, 35, 45, 0.4)
                      - backdrop-filter: blur(10px)
                      - border: 1px solid rgba(255,255,255,0.08)
                      - border-radius: 16px
                      - padding: 20px
                      - transition: all 0.3s ease
                    card:hover:
                      - border-color: rgba(74, 222, 128, 0.4)
                      - box-shadow: 0 0 30px rgba(74, 222, 128, 0.1)
                    icon:
                      - color: rgba(255,255,255,0.5)
                      - width: 28px
                      - height: 28px
                    name:
                      - font-size: 13px
                      - color: rgba(255,255,255,0.7)
                      - margin-top: 8px
                  card_mod:
                    style: |
                      :host {
                        padding: 0 0 0 8px
                      }
                - type: custom:button-card
                  entity: button.gwmbrasil_${VEICULO}_fechar_os_vidros
                  name: Fechar
                  icon: mdi:car-windshield
                  tap_action:
                    action: call-service
                    service: button.press
                    service_data:
                      entity_id: button.gwmbrasil_${VEICULO}_fechar_os_vidros
                  styles:
                    card:
                      - background: rgba(30, 35, 45, 0.4)
                      - backdrop-filter: blur(10px)
                      - border: 1px solid rgba(255,255,255,0.08)
                      - border-radius: 16px
                      - padding: 20px
                      - transition: all 0.3s ease
                    card:hover:
                      - border-color: rgba(248, 113, 113, 0.4)
                      - box-shadow: 0 0 30px rgba(248, 113, 113, 0.1)
                    icon:
                      - color: rgba(255,255,255,0.5)
                      - width: 28px
                      - height: 28px
                    name:
                      - font-size: 13px
                      - color: rgba(255,255,255,0.7)
                      - margin-top: 8px
                  card_mod:
                    style: |
                      :host {
                        padding: 0 8px 0 0
                      }
            - type: custom:button-card
              name: TETO SOLAR
              show_icon: false
              entity: sensor.gwmbrasil_${VEICULO}_posicao_do_teto_solar
              styles:
                card:
                  - background: transparent
                  - box-shadow: none
                  - padding: 16px 8px 0 8px
                name:
                  - font-size: 11px
                  - font-weight: '500'
                  - letter-spacing: 1px
                  - color: rgba(255,255,255,0.4)
                  - justify-self: start
                grid:
                  - grid-template-areas: '"n status"'
                  - grid-template-columns: 1fr auto
              custom_fields:
                status: |
                  [[[
                    const status = states[`sensor.gwmbrasil_${VEICULO}_posicao_do_teto_solar`].state;
                    if (status === 'none') return '';
                    const isOpen = status !== '3';
                    const color = isOpen ? '#f87171' : '#4ade80';
                    const text = isOpen ? 'Aberto' : 'Fechado';
                    return `<span style="display:flex;align-items:center;gap:6px;">
                      <span style="width:6px;height:6px;border-radius:50%;background:${color};animation:pulse 2s infinite;"></span>
                      <span style="font-size:11px;color:${color};">${text}</span>
                    </span>`;
                  ]]]
            - type: horizontal-stack
              cards:
                - type: custom:button-card
                  entity: button.gwmbrasil_${VEICULO}_abrir_teto_solar
                  name: Abrir
                  icon: mdi:weather-sunny
                  tap_action:
                    action: call-service
                    service: button.press
                    service_data:
                      entity_id: button.gwmbrasil_${VEICULO}_abrir_teto_solar
                  styles:
                    card:
                      - background: rgba(30, 35, 45, 0.4)
                      - backdrop-filter: blur(10px)
                      - border: 1px solid rgba(255,255,255,0.08)
                      - border-radius: 16px
                      - padding: 20px
                      - transition: all 0.3s ease
                    card:hover:
                      - border-color: rgba(251, 191, 36, 0.4)
                      - box-shadow: 0 0 30px rgba(251, 191, 36, 0.1)
                    icon:
                      - color: rgba(255,255,255,0.5)
                      - width: 28px
                      - height: 28px
                    name:
                      - font-size: 13px
                      - color: rgba(255,255,255,0.7)
                      - margin-top: 8px
                  card_mod:
                    style: |
                      :host {
                        padding: 0 0 0 8px
                      }
                - type: custom:button-card
                  entity: button.gwmbrasil_${VEICULO}_fechar_teto_solar
                  name: Fechar
                  icon: mdi:weather-night
                  tap_action:
                    action: call-service
                    service: button.press
                    service_data:
                      entity_id: button.gwmbrasil_${VEICULO}_fechar_teto_solar
                  styles:
                    card:
                      - background: rgba(30, 35, 45, 0.4)
                      - backdrop-filter: blur(10px)
                      - border: 1px solid rgba(255,255,255,0.08)
                      - border-radius: 16px
                      - padding: 20px
                      - transition: all 0.3s ease
                    card:hover:
                      - border-color: rgba(96, 165, 250, 0.4)
                      - box-shadow: 0 0 30px rgba(96, 165, 250, 0.1)
                    icon:
                      - color: rgba(255,255,255,0.5)
                      - width: 28px
                      - height: 28px
                    name:
                      - font-size: 13px
                      - color: rgba(255,255,255,0.7)
                      - margin-top: 8px
                  card_mod:
                    style: |
                      :host {
                        padding: 0 8px 0 0
                      }
    subview: true
    layout: {}
  - type: panel
    path: gwm-charging-history
    cards:
      - type: custom:config-template-card
        entities:
          - button.gwmbrasil_${VEICULO}_historico_de_carregamento
          - sensor.gwmbrasil_${VEICULO}_estado_de_carga_soc
        card:
          type: vertical-stack
          cards:
            - type: custom:mushroom-template-card
              primary: Atualizar hist√≥rico de carregamento
              icon: mdi:clipboard-clock-outline
              entity: button.gwmbrasil_${VEICULO}_historico_de_carregamento
              hold_action:
                action: none
              tap_action:
                action: toggle
            - type: custom:gwm-charging-history-card
              entity: sensor.gwmbrasil_${VEICULO}_estado_de_carga_soc
    title: Hist√≥rico de carregamento
    icon: mdi:clipboard-text-clock
    subview: false
  - type: panel
    path: mapa
    title: Mapa
    icon: mdi:map-marker-distance
    cards:
      - type: grid
        square: false
        cards:
          - type: custom:config-template-card
            entities:
              - select.gwmbrasil_veiculos_registrados
              - sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo
            card:
              type: custom:mushroom-title-card
              title: >
                {% set vin = states('select.gwmbrasil_veiculos_registrados') %}
                {% set modelo = 
                states('sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo') %}

                Ve√≠culo: {{ [vin, modelo]
                   | reject('in', ['unknown', 'unavailable', ''])
                   | join(' - ') }}
              card_mod:
                style: |
                  :host {
                    display: {% if state_attr('select.gwmbrasil_veiculos_registrados', 'options') | length > 1 %} block {% else %} none {% endif %};
                  }
                  ha-card h1 {
                    font-size: 14px !important;
                    font-weight: 500;
                    letter-spacing: 0.5px;
                  }
          - type: energy-date-selection
            card_mod:
              style: |
                ha-card {
                  z-index: 1;
                  position: absolute;
                  height: 80px !important;
                  width: 80%;
                  top: 75px;
                  right: 10px;
                  max-width: 450px;
                  color: white;
                  background: rgb(0,0,0,0.7);
                }
          - type: custom:config-template-card
            entities:
              - select.gwmbrasil_veiculos_registrados
              - sensor.gwmbrasil_${VEICULO}_endereco_atual
            card:
              type: custom:mushroom-entity-card
              entity: sensor.gwmbrasil_${VEICULO}_endereco_atual
              name: ' '
          - type: custom:auto-entities
            card:
              type: custom:map-card
              history_date_selection: true
              card_mod:
                style: |
                  ha-card {
                    margin-top: -10px;
                  }
                  ha-card #map {
                    height:calc(100vh - 56px);
                    border-radius:0;
                  }
            filter:
              template: >
                {% set veiculo = states('select.gwmbrasil_veiculos_registrados')
                | lower %} {% if veiculo not in ['unknown', 'unavailable', '']
                %}
                  {{ 'device_tracker.gwmbrasil_' ~ veiculo }}
                {% endif %}
        columns: 1
  - type: panel
    path: gwm-3d
    title: gwm-3d
    icon: mdi:video-3d
    cards:
      - type: custom:config-template-card
        entities:
          - sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo
          - sensor.gwmbrasil_${VEICULO}_tipo_de_motor
        card:
          type: iframe
          aspect_ratio: 100%
          url: >-
            ${ (function () {

            const modelo =
            states[`sensor.gwmbrasil_${VEICULO}_modelo_do_veiculo`]?.state;
            const motor  =
            states[`sensor.gwmbrasil_${VEICULO}_tipo_de_motor`]?.state;

            let name = "WEY07";

            if (modelo === "HAVAL H6 HEV" && motor === "GW4B15M") name =
            "NOVOH6HEV2"; else if (modelo === "HAVAL H6 HEV") name = "H6HEV2";
            else if (modelo === "HAVAL H6 PHEV" && motor === "GW4B15M") name =
            "NOVOH6PHEV35"; else if (modelo === "HAVAL H6 PHEV") name =
            "H6PHEV"; else if (modelo === "HAVAL H6 PHEV (FWD)" && motor ===
            "GW4B15M") name = "NOVOH6PHEV19"; else if (modelo === "HAVAL H6 PHEV
            (FWD)") name = "H6PHEVFWD"; else if (modelo === "HAVAL H6 GT PHEV"
            && motor === "GW4B15M") name = "NOVOH6GT"; else if (modelo ===
            "HAVAL H6 GT PHEV") name = "H6GT"; else if (modelo === "ORA 03 Skin
            (BEV48)") name = "ES11"; else if (modelo === "ORA 03 (BEV58)") name
            = "ES11THA"; else if (modelo === "ORA 03 GT") name = "ES11GT"; else
            if (modelo === "Tank 300") name = "TANK300"; else if (modelo ===
            "Poer P30") name = "POER_Mid"; else if (modelo === "Poer P30
            Exclusive") name = "POER_High"; else if (modelo === "HAVAL H9") name
            = "H9";

            return "https://br-h5-abroad-community.gwmcloud.com/br-vr/?name=" +
            name;

            })() }
